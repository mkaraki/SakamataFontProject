name: PR Commenter

on:
  pull_request:

jobs:
  makecomment:
    strategy:
      matrix:
        weight: [0]
        strict: ["nostrict"]

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Build
        uses: ./.github/actions/build-ttf
        with:
          weight: ${{ matrix.weight }}
          strict: ${{ matrix.strict }}

      - name: Download artifacts
        uses: actions/download-artifact@v3
        with:
          name: sakamata-font-${{ matrix.weight }}-${{ matrix.strict }}
          path: artifact

      - name: Install requirements
        run: pip install pillow opencv-python matplotlib numpy cairosvg fonttools

      - name: Make grid image
        run: |
          cd artifact
          python ../pr-commenter/grid.py
        env:
          FONTNAME: sakamata-font-${{ matrix.weight }}-${{ matrix.strict }}.ttf

      - name: PR comment with file
        uses: thollander/actions-comment-pull-request@v2
        with:
          filePath: artifact/result.png
